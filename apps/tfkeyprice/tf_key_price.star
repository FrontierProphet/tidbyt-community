load("render.star", "render")
load("http.star", "http")
load("encoding/base64.star", "base64")

KEY_PRICE_URL = "https://backpack.tf/api/IGetCurrencies/v1?raw=1&key=6594beeaba29d5eb6204c3ab"

TF2_ICON = base64.decode("""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""")

def main(config):
    rep = http.get(KEY_PRICE_URL, ttl_seconds = 240)
    if rep.status_code != 200:
        fail("Bakcpack.tf request failed with status %d", rep.status_code)

    rate = rep.json()["response"]["currencies"]["keys"]["price"]["value_raw"]

    return render.Root(
        child = render.Row(
            children = [
                render.Image(src = TF2_ICON),
                render.Column(
                    children = [
                        render.Marquee(
                            width = 32,
                            child = render.Text("Mann Co. Supply Crate Key"),
                        ),
                        render.Text("%d REF" % rate),
                    ],
                    expanded = True,
                    main_align = "space_evenly",
                    cross_align = "center",
                ),
            ],
            main_align = "space_between",
            cross_align = "center",
        ),
    )
